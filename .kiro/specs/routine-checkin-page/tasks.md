# 实现计划 - 日程打卡页面

- [x] 1. 创建数据模型和数据库结构



  - 创建 `RoutineTask`、`CheckInRecord`、`RoutineTaskWithStats` 数据类
  - 定义 `CycleType`、`CycleConfig` 枚举和密封类
  - 创建 `RoutineTaskEntity` 和 `CheckInRecordEntity` 数据库实体
  - 实现 JSON 序列化器用于 `CycleConfig` 存储


  - _需求: 1.1, 1.2, 1.3, 1.4, 1.5, 1.6_



- [x] 2. 实现数据访问层




  - [x] 2.1 创建 RoutineTaskDao 接口

    - 实现基本 CRUD 操作（insert, update, delete, getById）


    - 实现查询所有活跃任务的方法
    - 使用 Flow 实现响应式数据流
    - _需求: 1.6, 7.1_
  

  - [x] 2.2 创建 CheckInRecordDao 接口

    - 实现打卡记录的插入和删除


    - 实现按任务 ID 查询打卡记录
    - 实现按周期范围查询打卡记录





    - 实现统计周期内打卡次数的方法


    - 创建必要的数据库索引
    - _需求: 2.2, 2.3, 2.6, 6.2, 6.3_



  

  - [ ] 2.3 更新数据库配置
    - 在 AppDatabase 中添加新的表定义


    - 创建数据库迁移脚本
    - 配置外键级联删除
    - _需求: 1.6, 2.6_

- [x] 3. 实现周期计算逻辑



  - [x] 3.1 创建 CycleCalculator 工具类

    - 实现 `isInActiveCycle` 方法判断任务活跃状态
    - 实现 `getCurrentCycle` 方法获取当前周期范围
    - 实现 `getNextActiveDate` 方法获取下次活跃日期
    - 实现 `getCycleDescription` 方法生成周期描述文本
    - _需求: 7.1, 7.2, 7.3, 7.4, 7.5, 7.6_
  

  - [ ] 3.2 编写 CycleCalculator 单元测试
    - 测试每日任务始终活跃
    - 测试每周任务在配置日期活跃
    - 测试每月任务在配置日期活跃
    - 测试周期范围计算
    - 测试下次活跃日期计算
    - _需求: 7.1, 7.2, 7.3, 7.4_

- [x] 4. 实现 Repository 层


  - [x] 4.1 创建 RoutineRepository 接口和实现


    - 实现任务的创建、更新、删除操作
    - 实现打卡操作，自动计算周期范围
    - 实现查询任务及统计信息的方法
    - 集成 CycleCalculator 计算活跃状态
    - 实现错误处理和重试机制
    - _需求: 1.1, 1.2, 1.3, 1.4, 1.5, 1.6, 2.1, 2.2, 2.3, 2.4, 2.5, 2.6, 7.1_
  
  - [x] 4.2 编写 Repository 单元测试


    - 测试创建任务成功
    - 测试打卡创建正确的周期记录
    - 测试获取周期内打卡次数
    - 测试删除任务级联删除打卡记录
    - _需求: 1.6, 2.2, 2.6_

- [x] 5. 实现 ViewModel


  - [x] 5.1 创建 RoutineViewModel


    - 定义 `RoutineUiState` 数据类
    - 实现加载任务列表的方法
    - 实现任务排序逻辑（活跃/非活跃分组，次数排序）
    - 实现打卡操作的方法
    - 实现任务创建、更新、删除的方法
    - 实现错误处理和状态管理
    - _需求: 2.1, 2.2, 2.3, 2.4, 2.5, 3.1, 3.2, 3.3, 3.4, 3.5, 3.6, 3.7, 5.1, 5.2, 5.3, 5.4, 5.5, 5.6_
  
  - [x] 5.2 编写 ViewModel 单元测试


    - 测试加载任务分离活跃和非活跃
    - 测试打卡更新任务统计
    - 测试任务排序正确性
    - 测试错误处理显示正确消息
    - _需求: 3.7, 5.1, 5.2, 5.3, 5.4, 5.5_

- [x] 6. 实现 UI 组件

  - [x] 6.1 创建 RoutineCard 组件




    - 实现 Material 3 卡片样式（活跃/非活跃）
    - 显示任务图标、标题、周期信息
    - 突出显示打卡次数（大号字体，主题色）
    - 实现打卡按钮（活跃时可用，非活跃时禁用）
    - 显示非活跃任务的下次活跃时间
    - 实现点击卡片导航到详情
    - 添加内容描述和可访问性支持
    - _需求: 3.1, 3.2, 3.3, 3.4, 3.5, 3.6, 4.1, 4.2, 4.3, 4.4, 4.5, 4.6, 5.1, 5.2, 5.3, 5.4, 5.5, 5.6, 8.1, 8.2, 8.3, 8.4, 8.5, 8.6, 8.7_
  
  - [x] 6.2 创建 CheckInButton 组件


    - 实现 FilledTonalButton 样式
    - 根据活跃状态启用/禁用按钮
    - 添加点击反馈动画
    - 添加可访问性描述
    - _需求: 2.1, 2.5, 5.5, 8.1, 8.2, 8.3, 8.4, 8.5_
  
  - [x] 6.3 创建 RoutineScreen 主屏幕


    - 实现顶部栏（标题、日期显示、添加按钮）
    - 使用 LazyColumn 显示任务列表
    - 实现活跃/非活跃任务分组显示
    - 实现任务排序（活跃在前，按次数排序）
    - 集成 RoutineViewModel
    - 实现打卡成功动画（次数放大效果）
    - 实现错误提示 Snackbar
    - 实现加载状态显示
    - _需求: 3.1, 3.2, 3.3, 3.4, 3.5, 3.6, 3.7, 5.1, 5.2, 5.3, 5.4, 5.5, 5.6, 8.1, 8.2, 8.3, 8.4, 8.5, 8.6, 8.7_

- [x] 7. 实现任务详情页面







  - [x] 7.1 创建 RoutineDetailScreen

    - 显示任务完整信息（标题、描述、图标、周期配置）
    - 显示当前周期统计信息
    - 显示打卡历史记录列表（按周期分组）
    - 实现编辑任务功能
    - 实现删除任务功能
    - 实现删除单条打卡记录功能
    - _需求: 6.1, 6.2, 6.3, 6.4, 6.5, 6.6_
  

  - [x] 7.2 创建 RoutineDetailViewModel

    - 实现加载任务详情和打卡历史
    - 实现按周期分组打卡记录
    - 实现统计每个周期的打卡次数
    - 实现编辑和删除任务
    - 实现删除打卡记录
    - _需求: 6.1, 6.2, 6.3, 6.4, 6.5, 6.6_

- [x] 8. 实现任务创建/编辑页面




  - [x] 8.1 创建 CreateRoutineSheet 底部表单

    - 实现任务标题输入
    - 实现任务描述输入
    - 实现图标选择器（Material Icons）
    - 实现周期类型选择（每日/每周/每月）
    - 实现每周任务的星期选择器
    - 实现每月任务的日期选择器
    - 实现表单验证
    - 实现保存和取消操作
    - _需求: 1.1, 1.2, 1.3, 1.4, 1.5, 1.6_
  

  - [-] 8.2 创建图标选择器组件

    - 显示常用 Material Icons 网格
    - 实现图标搜索功能
    - 实现图标选择反馈
    - _需求: 1.2, 8.1, 8.2, 8.3, 8.4, 8.5_

- [x] 9. 集成导航和路由




  - [x] 9.1 更新导航图

    - 添加 RoutineScreen 路由
    - 添加 RoutineDetailScreen 路由
    - 配置屏幕间导航
    - 传递任务 ID 参数
    - _需求: 3.1, 4.6, 6.1_
  

  - [x] 9.2 添加底部导航入口

    - 在主导航栏添加"日程"选项
    - 配置图标和标签
    - 实现导航切换
    - _需求: 3.1_

- [x] 10. 添加国际化支持


  - [x] 10.1 添加中文字符串资源

    - 添加所有 UI 文本的中文翻译
    - 添加周期类型的本地化文本
    - 添加错误消息的本地化文本
    - _需求: 3.1, 3.2, 3.3, 3.4, 3.5, 3.6, 3.7_
  

  - [x] 10.2 添加其他语言支持

    - 添加英文翻译（values/strings.xml）
    - 添加日文翻译（values-ja/strings.xml）
    - 实现日期格式化的本地化
    - _需求: 3.1, 3.2, 3.3, 3.4, 3.5, 3.6, 3.7_


- [ ] 11. 编写 UI 测试
  - 测试活跃任务显示在顶部
  - 测试非活跃任务显示为灰色
  - 测试非活跃任务打卡按钮禁用
  - 测试打卡后次数更新
  - 测试卡片点击导航到详情
  - _需求: 3.1, 3.2, 3.3, 3.4, 3.5, 3.6, 3.7, 5.1, 5.2, 5.3, 5.4, 5.5_


- [ ] 12. 性能优化和最终调整
  - 实现数据库查询优化和索引
  - 实现周期计算结果缓存
  - 优化列表滚动性能
  - 优化动画性能
  - 进行内存泄漏检查
  - _需求: 7.6_
