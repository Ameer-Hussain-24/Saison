# 需求文档

## 简介

本功能旨在升级番茄钟页面，采用Material 3风格重新设计UI，并增加闹钟提醒功能和与日程打卡页面的联动功能。用户可以选择设置了活动时长的打卡任务进行倒计时，倒计时结束后自动标记任务完成，也可以在倒计时进行中选择提前结束并标记为完成。

## 术语表

- **番茄钟系统（Pomodoro System）**：应用中的计时器功能模块，用于帮助用户进行时间管理
- **日程打卡任务（Routine Task）**：用户创建的周期性任务，可以设置活动时长
- **活动时长（Duration）**：日程打卡任务中设置的单次活动所需时间（分钟）
- **闹钟提醒（Alarm Notification）**：倒计时结束时的声音或震动提醒
- **自动标记完成（Auto Complete）**：倒计时结束后自动将关联的日程打卡任务标记为完成一次
- **提前结束（Early Finish）**：在倒计时进行中手动结束并标记任务完成

## 需求

### 需求 1：Material 3 风格UI重设计

**用户故事：** 作为用户，我希望番茄钟页面采用Material 3风格设计，以便获得更现代、更一致的视觉体验。

#### 验收标准

1. THE 番茄钟系统 SHALL 使用Material 3的颜色系统（primary, secondary, tertiary等）渲染所有UI组件
2. THE 番茄钟系统 SHALL 使用Material 3的圆角规范（small, medium, large）设计卡片和按钮
3. THE 番茄钟系统 SHALL 使用Material 3的间距系统（4dp基准）布局所有元素
4. THE 番茄钟系统 SHALL 使用Material 3的图标（Material Icons）替换所有现有图标
5. THE 番茄钟系统 SHALL 使用Material 3的动画效果（如淡入淡出、缩放）增强交互体验

### 需求 2：闹钟提醒功能

**用户故事：** 作为用户，我希望在倒计时结束时收到声音或震动提醒，以便及时知道任务时间已到。

#### 验收标准

1. WHEN 倒计时结束，THE 番茄钟系统 SHALL 播放提醒声音
2. WHEN 倒计时结束，THE 番茄钟系统 SHALL 触发设备震动
3. THE 番茄钟系统 SHALL 在设置中提供开关选项以启用或禁用声音提醒
4. THE 番茄钟系统 SHALL 在设置中提供开关选项以启用或禁用震动提醒
5. WHEN 用户禁用声音提醒，THE 番茄钟系统 SHALL 仅在倒计时结束时触发震动（如果震动已启用）
6. WHEN 用户禁用震动提醒，THE 番茄钟系统 SHALL 仅在倒计时结束时播放声音（如果声音已启用）

### 需求 3：日程打卡任务选择

**用户故事：** 作为用户，我希望在番茄钟页面选择一个设置了活动时长的日程打卡任务，以便为该任务进行专注计时。

#### 验收标准

1. THE 番茄钟系统 SHALL 显示一个任务选择按钮，允许用户选择日程打卡任务
2. WHEN 用户点击任务选择按钮，THE 番茄钟系统 SHALL 显示包含所有设置了活动时长的日程打卡任务的列表
3. THE 番茄钟系统 SHALL 在任务列表中显示每个任务的标题、图标和活动时长
4. WHEN 用户选择一个任务，THE 番茄钟系统 SHALL 将倒计时时长设置为该任务的活动时长
5. THE 番茄钟系统 SHALL 在番茄钟页面显示当前选择的任务信息（标题和图标）
6. THE 番茄钟系统 SHALL 允许用户在倒计时开始前更改选择的任务
7. THE 番茄钟系统 SHALL 过滤掉活动时长为0或未设置的日程打卡任务

### 需求 4：自动标记完成

**用户故事：** 作为用户，我希望倒计时结束后自动将关联的日程打卡任务标记为完成一次，以便自动记录我的任务完成情况。

#### 验收标准

1. WHEN 倒计时结束 AND 用户已选择日程打卡任务，THE 番茄钟系统 SHALL 自动为该任务创建一次打卡记录
2. THE 番茄钟系统 SHALL 在打卡记录中包含完成时间戳
3. THE 番茄钟系统 SHALL 在打卡记录的备注中标注"通过番茄钟完成"
4. WHEN 自动打卡成功，THE 番茄钟系统 SHALL 显示成功提示消息
5. WHEN 自动打卡失败，THE 番茄钟系统 SHALL 显示错误提示消息并允许用户手动重试
6. WHEN 倒计时结束 AND 用户未选择日程打卡任务，THE 番茄钟系统 SHALL 仅记录番茄钟会话，不创建打卡记录

### 需求 5：提前结束功能

**用户故事：** 作为用户，我希望在倒计时进行中可以选择提前结束并标记任务完成，以便在实际完成任务时灵活处理。

#### 验收标准

1. WHILE 倒计时运行中，THE 番茄钟系统 SHALL 显示"提前结束"按钮
2. WHEN 用户点击"提前结束"按钮，THE 番茄钟系统 SHALL 显示确认对话框
3. THE 番茄钟系统 SHALL 在确认对话框中询问用户是否要标记任务为完成
4. WHEN 用户确认提前结束并标记完成 AND 已选择日程打卡任务，THE 番茄钟系统 SHALL 停止倒计时并为该任务创建打卡记录
5. WHEN 用户确认提前结束但不标记完成，THE 番茄钟系统 SHALL 停止倒计时但不创建打卡记录
6. WHEN 用户取消提前结束，THE 番茄钟系统 SHALL 继续倒计时
7. THE 番茄钟系统 SHALL 在提前结束的打卡记录备注中标注"提前结束"和实际用时

### 需求 6：倒计时状态显示

**用户故事：** 作为用户，我希望清楚地看到当前倒计时的状态和关联的任务信息，以便了解当前的工作进度。

#### 验收标准

1. WHILE 倒计时运行中，THE 番茄钟系统 SHALL 显示剩余时间（分钟和秒）
2. WHILE 倒计时运行中，THE 番茄钟系统 SHALL 显示进度环形指示器
3. WHEN 用户已选择日程打卡任务，THE 番茄钟系统 SHALL 在倒计时界面显示任务标题
4. WHEN 用户已选择日程打卡任务，THE 番茄钟系统 SHALL 在倒计时界面显示任务图标
5. THE 番茄钟系统 SHALL 使用不同的颜色区分运行、暂停和完成状态
6. THE 番茄钟系统 SHALL 在倒计时完成后显示完成动画效果

### 需求 7：设置持久化

**用户故事：** 作为用户，我希望我的闹钟提醒设置能够被保存，以便下次使用时不需要重新配置。

#### 验收标准

1. THE 番茄钟系统 SHALL 将声音提醒开关状态保存到本地存储
2. THE 番茄钟系统 SHALL 将震动提醒开关状态保存到本地存储
3. WHEN 应用启动，THE 番茄钟系统 SHALL 从本地存储加载声音提醒设置
4. WHEN 应用启动，THE 番茄钟系统 SHALL 从本地存储加载震动提醒设置
5. THE 番茄钟系统 SHALL 在用户更改设置后立即保存到本地存储
