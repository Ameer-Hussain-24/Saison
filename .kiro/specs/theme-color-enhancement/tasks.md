# 实现计划

- [x] 1. 完善所有主题的颜色定义

  - 为每个主题添加完整的 Material Design 3 颜色角色定义（primary、secondary、tertiary、error、background、surface 及其对应的 on 颜色）
  - 确保浅色和深色模式都有完整定义
  - 验证颜色对比度符合 WCAG 2.1 AA 标准
  - _需求: 1.1, 1.2, 1.3, 1.4_

- [x] 1.1 更新 Color.kt 文件 - 添加缺失的颜色常量


  - 为 Sakura、Mint、Amber、Snow、Rain、Maple 主题添加完整颜色定义
  - 为 Ocean、Sunset、Forest、Lavender、Desert、Aurora 主题添加完整颜色定义
  - 为 Tech Purple、Black Mamba、Grey Style 主题优化和补充颜色定义
  - 每个主题需要定义：tertiary、onTertiary、tertiaryContainer、onTertiaryContainer、error、onError、errorContainer、onErrorContainer、background、onBackground、surface、onSurface、surfaceVariant、onSurfaceVariant、outline、outlineVariant
  - _需求: 1.1, 1.2_



- [ ] 1.2 更新 Theme.kt 文件 - 完善 ColorScheme 定义
  - 更新所有主题的 lightColorScheme 和 darkColorScheme，包含所有必需的颜色角色
  - 确保每个 ColorScheme 都使用 Color.kt 中定义的颜色常量


  - 移除硬编码的颜色值
  - _需求: 1.1, 1.2, 1.3_

- [ ] 1.3 实现颜色对比度验证工具
  - 创建 ColorContrastChecker 工具类


  - 实现 calculateContrast() 方法计算两个颜色的对比度
  - 实现 meetsWCAGAA() 方法验证是否符合 WCAG AA 标准
  - 实现 calculateLuminance() 方法计算相对亮度
  - _需求: 1.4, 4.1, 4.2, 4.3_

- [ ] 1.4 验证所有主题的颜色对比度
  - 使用 ColorContrastChecker 验证每个主题的文本和背景对比度
  - 记录不符合标准的颜色组合
  - 调整颜色以满足对比度要求


  - _需求: 1.4, 4.1, 4.2, 4.3, 4.4_

- [ ] 2. 优化主题预览功能
  - 更新主题预览卡片以显示4种代表性颜色（primary、secondary、tertiary、surface）


  - 为预览颜色添加标签说明
  - 优化预览卡片的布局和视觉效果
  - _需求: 2.1, 2.2, 2.3, 2.4_

- [ ] 2.1 更新 ThemePreviewColors 数据类
  - 添加 surface 颜色字段
  - 更新所有主题的 getThemePreviewColors() 函数返回4种颜色
  - 确保预览颜色与实际应用的颜色一致
  - _需求: 2.1, 2.2, 2.3_

- [ ] 2.2 重新设计 ThemePreviewCard 组件
  - 更新颜色预览条以显示4种颜色
  - 为每种颜色添加标签（主色、次色、第三色、表面）
  - 优化卡片布局，确保在不同屏幕尺寸下都能良好显示
  - 添加颜色名称或色值的悬停提示
  - _需求: 2.1, 2.2, 2.3, 2.4_

- [ ] 2.3 优化主题选择 Bottom Sheet
  - 确保 Bottom Sheet 能正确显示所有16个主题
  - 优化滚动性能和动画效果
  - 添加主题分类（季节性主题、专业主题）
  - _需求: 2.1, 3.4_

- [ ] 3. 优化特殊主题配色
  - 重新设计黑曼巴、科技紫、小黑紫主题的配色方案
  - 确保特殊主题在浅色和深色模式下都有良好的视觉效果
  - 验证特殊主题的颜色协调性和对比度
  - _需求: 5.1, 5.2, 5.3, 5.4_

- [ ] 3.1 优化黑曼巴主题配色
  - 调整金色、紫色、黑色的配比和亮度
  - 确保金色背景上的文本可读性（对比度 > 7:1）
  - 优化深色模式的配色方案
  - 添加适当的 tertiary 颜色用于平衡
  - _需求: 5.1, 5.4_

- [ ] 3.2 优化科技紫主题配色
  - 创建5个层次的紫色渐变
  - 确保每个层次之间有足够的对比度
  - 优化深色模式的紫色亮度
  - 添加适当的 secondary 和 tertiary 颜色
  - _需求: 5.2, 5.4_

- [ ] 3.3 优化小黑紫主题配色
  - 平衡紫色和灰色的比例（60-30-10原则）
  - 确保紫色用于强调，灰色用于信息展示
  - 优化深色模式的配色方案
  - 添加适当的 tertiary 颜色用于点缀
  - _需求: 5.3, 5.4_

- [ ] 4. 验证主题应用的一致性
  - 测试所有主题在不同界面的显示效果
  - 确保主题切换时所有UI元素正确更新
  - 验证状态栏和导航栏颜色与主题协调
  - _需求: 3.1, 3.2, 3.3, 3.4_

- [ ] 4.1 测试主要界面的主题应用
  - 测试任务列表、日历、课程表、番茄钟、节拍器、设置界面
  - 验证顶部导航栏、底部导航栏、卡片、按钮、文本的颜色
  - 确保所有界面元素使用正确的颜色角色
  - _需求: 3.1, 3.2_

- [ ] 4.2 测试对话框和 Bottom Sheet 的主题应用
  - 测试所有对话框（语言选择、WebDAV配置、番茄钟设置等）
  - 测试所有 Bottom Sheet（主题选择、底部导航设置）
  - 验证遮罩层、背景、文本颜色
  - _需求: 3.1, 3.2_

- [ ] 4.3 优化主题切换动画
  - 添加平滑的颜色过渡动画
  - 确保切换过程中没有闪烁或跳跃
  - 优化切换性能
  - _需求: 3.4_

- [ ] 4.4 验证状态栏和导航栏颜色
  - 确保状态栏颜色与主题协调
  - 根据主题亮度自动调整状态栏图标颜色（深色/浅色）
  - 测试不同 Android 版本的兼容性
  - _需求: 3.3_

- [ ] 5. 增强动态主题支持
  - 优化 Android 12+ 的动态颜色提取
  - 实现动态主题的回退机制
  - 测试壁纸更改时的主题更新
  - _需求: 6.1, 6.2, 6.3, 6.4_

- [ ] 5.1 优化动态主题实现
  - 确保 dynamicLightColorScheme 和 dynamicDarkColorScheme 正确应用
  - 添加动态主题不可用时的回退逻辑
  - 测试不同设备和 Android 版本的兼容性
  - _需求: 6.1, 6.2_

- [ ] 5.2 实现壁纸更改监听
  - 监听系统壁纸更改事件
  - 在壁纸更改时自动更新动态主题颜色
  - 添加适当的防抖机制避免频繁更新
  - _需求: 6.4_

- [ ] 5.3 测试动态主题与其他主题的切换
  - 测试从动态主题切换到其他主题
  - 测试从其他主题切换到动态主题
  - 确保切换流畅无卡顿
  - _需求: 6.3_

- [ ] 6. 添加错误处理和日志
  - 在主题应用失败时提供回退机制
  - 添加详细的错误日志
  - 实现主题应用状态监控
  - _需求: 1.1, 3.1_

- [ ] 6.1 实现主题应用错误处理
  - 在 SaisonTheme 中添加 try-catch 错误处理
  - 主题应用失败时回退到默认主题
  - 记录错误日志包含主题名称和错误信息
  - _需求: 1.1_

- [ ] 6.2 添加主题应用状态监控
  - 创建 ThemeMonitor 类监控主题应用状态
  - 记录主题切换时间和成功/失败状态
  - 提供主题应用诊断信息
  - _需求: 3.1_

- [ ] 6.3 添加开发者调试工具
  - 创建主题调试界面显示当前主题的所有颜色
  - 添加颜色对比度实时检查工具
  - 提供主题导出功能（用于文档和测试）
  - _需求: 1.4, 4.1_

- [ ] 7. 性能优化
  - 优化颜色计算和缓存
  - 优化主题预览列表的渲染性能
  - 减少主题切换时的重组次数
  - _需求: 3.4_

- [ ] 7.1 实现颜色缓存机制
  - 使用 remember 缓存主题预览颜色
  - 使用 derivedStateOf 优化状态计算
  - 避免不必要的颜色重新计算
  - _需求: 3.4_

- [ ] 7.2 优化主题预览列表性能
  - 确保 LazyColumn 正确使用 key 参数
  - 优化 ThemePreviewCard 的重组范围
  - 使用 Modifier.drawBehind 优化颜色预览条的绘制
  - _需求: 3.4_

- [ ] 7.3 分析和优化主题切换性能
  - 使用 Compose Profiler 分析主题切换性能
  - 识别性能瓶颈并优化
  - 确保主题切换在 16ms 内完成（60fps）
  - _需求: 3.4_

- [ ] 8. 无障碍功能增强
  - 为主题预览添加完整的语义化标签
  - 实现 TalkBack 支持
  - 确保所有主题符合无障碍标准
  - _需求: 1.4, 4.1, 4.2_

- [ ] 8.1 添加语义化标签
  - 为 ThemePreviewCard 添加 contentDescription
  - 为颜色预览添加颜色名称描述
  - 为主题选择状态添加语音反馈
  - _需求: 1.4_

- [ ] 8.2 实现 TalkBack 支持
  - 在主题切换时发送 AccessibilityEvent
  - 提供主题名称和颜色的语音描述
  - 测试 TalkBack 的完整流程
  - _需求: 4.1_

- [ ] 8.3 验证无障碍合规性
  - 使用 Accessibility Scanner 扫描主题选择界面
  - 修复所有无障碍问题
  - 确保符合 WCAG 2.1 AA 标准
  - _需求: 1.4, 4.1, 4.2_

- [ ] 9. 文档和测试
  - 编写主题使用文档
  - 创建单元测试验证颜色定义
  - 创建 UI 测试验证主题应用
  - _需求: 所有需求_

- [ ] 9.1 编写主题使用文档
  - 创建主题配色指南文档
  - 记录每个主题的设计理念和使用场景
  - 提供主题自定义指南
  - _需求: 所有需求_

- [ ] 9.2 创建单元测试
  - 测试 ColorContrastChecker 的对比度计算
  - 测试所有主题的颜色定义完整性
  - 测试颜色对比度符合标准
  - _需求: 1.1, 1.2, 1.3, 1.4, 4.1, 4.2_

- [ ] 9.3 创建 UI 测试
  - 测试主题切换功能
  - 测试主题预览显示
  - 测试所有界面的主题应用
  - _需求: 2.1, 2.2, 2.3, 3.1, 3.2, 3.3, 3.4_

- [ ] 9.4 创建视觉回归测试
  - 为每个主题创建截图基准
  - 实现自动化视觉对比测试
  - 在 CI/CD 中集成视觉回归测试
  - _需求: 3.1, 3.2_
